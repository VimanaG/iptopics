<!DOCTYPE html><html lang="it"><head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"><title>IP Topics — Wizard Proprietà Intellettuale</title>
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
 --red:#C62828;--red-light:#FDEAEA;--red-hover:#B71C1C;
 --navy:#1B2A4A;--g900:#1a1a2e;--g700:#374151;--g500:#6b7280;
 --g400:#9ca3af;--g200:#e5e7eb;--g100:#f3f4f6;--g50:#f9fafb;--white:#fff;
}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:var(--white);color:var(--g900);min-height:100vh;display:flex;flex-direction:column}
a{color:var(--red);text-decoration:none}
.wz-header{background:var(--white);border-bottom:1px solid var(--g200);position:sticky;top:0;z-index:40}
.wz-header-inner{max-width:640px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px 20px}
.wz-logo{display:flex;align-items:center;gap:8px}
.wz-logo-icon{width:32px;height:32px;border-radius:6px;overflow:hidden;display:flex;align-items:center;justify-content:center}
.wz-logo-icon img{width:100%;height:100%;object-fit:contain}
.wz-logo-text div:first-child{font-weight:800;font-size:15px;color:var(--g900)}
.wz-logo-text div:last-child{font-size:11px;color:var(--g500)}
.wz-restart{background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:4px;font-size:13px;color:var(--g400)}
.wz-restart:hover{color:var(--g500)}
.wz-progress-track{height:3px;background:var(--g100)}
.wz-progress-bar{height:3px;background:var(--red);border-radius:0 3px 3px 0;transition:width .4s ease}
.wz-main{flex:1;display:flex;align-items:center;justify-content:center;padding:32px 20px}
.wz-card{width:100%;max-width:580px;animation:fadeUp .25s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.wz-welcome{text-align:center}
.wz-welcome-icon{width:64px;height:64px;border-radius:16px;background:var(--red-light);display:flex;align-items:center;justify-content:center;margin:0 auto 20px}
.wz-welcome h1{font-size:27px;font-weight:800;color:var(--g900);margin-bottom:8px}
.wz-welcome p{color:var(--g500);max-width:420px;margin:0 auto 8px;line-height:1.6;font-size:15px}
.wz-welcome .wz-sub{font-size:13px;color:var(--g400);margin-bottom:24px}
.wz-welcome .wz-disclaimer{font-size:12px;color:var(--g400);max-width:360px;margin:20px auto 0}
.wz-step-label{font-size:12px;font-weight:700;color:var(--red);text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.wz-question{font-size:21px;font-weight:800;color:var(--g900);margin-bottom:2px}
.wz-subtitle{font-size:14px;color:var(--g500);margin-bottom:16px}
.wz-multi-hint{font-size:13px;color:var(--red);background:var(--red-light);border-radius:6px;padding:6px 12px;margin-bottom:14px;display:inline-block;font-weight:600}
.wz-option{width:100%;text-align:left;padding:14px 16px;border-radius:10px;cursor:pointer;border:2px solid var(--g200);background:var(--white);transition:all .15s;margin-bottom:8px;display:block;font-family:inherit}
.wz-option:hover{border-color:var(--g400)}
.wz-option.selected{border-color:var(--red);background:var(--red-light)}
.wz-option-inner{display:flex;align-items:flex-start;gap:12px}
.wz-radio{width:18px;height:18px;border-radius:50%;flex-shrink:0;margin-top:2px;border:2px solid var(--g400);display:flex;align-items:center;justify-content:center;transition:all .15s}
.wz-option.selected .wz-radio{border-color:var(--red);background:var(--red)}
.wz-radio-dot{width:6px;height:6px;border-radius:50%;background:#fff;display:none}
.wz-option.selected .wz-radio-dot{display:block}
.wz-option-label{font-weight:600;font-size:15px;color:var(--g900);transition:color .15s}
.wz-option.selected .wz-option-label{color:var(--red)}
.wz-option-desc{font-size:13px;color:var(--g500);margin-top:2px}
.wz-guide{background:var(--g50);border:1px solid var(--g200);border-radius:10px;margin-top:16px;overflow:hidden}
.wz-guide-toggle{width:100%;display:flex;align-items:center;gap:8px;padding:12px 16px;background:none;border:none;cursor:pointer;text-align:left;font-family:inherit}
.wz-guide-icon{color:var(--red);flex-shrink:0;width:16px;height:16px}
.wz-guide-title{flex:1;font-size:14px;font-weight:600;color:var(--navy)}
.wz-guide-chevron{width:16px;height:16px;color:var(--g400);transition:transform .25s}
.wz-guide.open .wz-guide-chevron{transform:rotate(180deg)}
.wz-guide-content{max-height:0;overflow:hidden;transition:max-height .3s ease,padding .3s ease}
.wz-guide.open .wz-guide-content{max-height:800px;padding:0 16px 14px}
.wz-guide-text{font-size:13.5px;line-height:1.7;color:var(--g700);white-space:pre-line}
.wz-rec{background:var(--red-light);border:1px solid #f5c6c6;border-radius:12px;padding:20px;margin-bottom:20px}
.wz-rec-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}
.wz-rec-header h3{font-weight:800;color:var(--red);font-size:17px}
.wz-rec p{font-size:14px;color:var(--g700);line-height:1.7;margin-bottom:14px}
.wz-rec-steps{border-top:1px solid #f5c6c6;padding-top:12px}
.wz-rec-steps-title{font-size:13px;font-weight:700;color:var(--navy);margin-bottom:6px;text-transform:uppercase;letter-spacing:.5px}
.wz-rec-step{display:flex;align-items:flex-start;gap:8px;margin-bottom:4px}
.wz-rec-step-num{font-size:13px;font-weight:700;color:var(--red);flex-shrink:0;width:18px;text-align:center}
.wz-rec-step-text{font-size:14px;color:var(--g700)}
.wz-answers{background:var(--g50);border-radius:12px;padding:20px;margin-bottom:20px;border:1px solid var(--g200)}
.wz-answers-title{font-size:13px;font-weight:700;color:var(--g400);text-transform:uppercase;letter-spacing:1px;margin-bottom:12px}
.wz-answer-row{margin-bottom:12px;padding-bottom:12px;border-bottom:1px solid var(--g200)}
.wz-answer-row:last-child{margin-bottom:0;padding-bottom:0;border-bottom:none}
.wz-answer-q{font-size:12px;font-weight:600;color:var(--g400);text-transform:uppercase;letter-spacing:.5px}
.wz-answer-a{font-size:15px;color:var(--g900);font-weight:600;margin-top:2px}
.wz-actions{display:flex;gap:10px;flex-wrap:wrap}
.wz-learn{background:var(--white);border:1px solid var(--g200);border-radius:12px;padding:22px;margin-bottom:20px}
.wz-learn-sec{margin:12px 0;padding:10px 12px;border:1px solid var(--g200);border-radius:12px;background:var(--g50)}
.wz-learn-sec h4{margin:0 0 6px;color:var(--g900);font-size:1.02rem}
.wz-learn-sec p{margin:0;color:var(--g700);line-height:1.55}
.wz-learn h3{font-size:18px;font-weight:900;color:var(--g900);margin-bottom:8px}
.wz-accordion{border:1px solid var(--g200);border-radius:12px;background:#fdf0ab;margin-bottom:20px;overflow:hidden}
.wz-accordion-summary{list-style:none;cursor:pointer;padding:16px 18px;font-weight:900;color:var(--g900);display:flex;align-items:center;gap:10px}
.wz-accordion-summary::-webkit-details-marker{display:none}
.wz-accordion[open] .wz-accordion-summary{border-bottom:1px solid var(--g200);background:var(--g50)}
.wz-accordion .wz-learn{border:0;margin:0}
.wz-learn p{font-size:14px;color:var(--g700);line-height:1.8;margin-bottom:10px}
.wz-learn .k{font-weight:800;color:var(--navy)}
.wz-learn ul{margin:8px 0 12px 18px}
.wz-learn li{margin:6px 0;color:var(--g700);line-height:1.7;font-size:14px}
.wz-pillrow{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 2px}
.wz-pill{font-size:12px;font-weight:700;border:1px solid var(--g200);background:var(--g50);color:var(--g700);padding:6px 10px;border-radius:999px}
.wz-note{background:var(--g50);border:1px dashed var(--g200);border-radius:10px;padding:12px;margin-top:10px;font-size:13px;color:var(--g700);line-height:1.7}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:10px 24px;border-radius:8px;font-weight:700;font-size:15px;cursor:pointer;font-family:inherit;transition:all .15s}
.btn-primary{background:var(--red);color:#fff;border:none}
.btn-primary:hover{background:var(--red-hover)}
.btn-primary:disabled{background:var(--g100);color:var(--g400);cursor:not-allowed}
.btn-secondary{background:var(--white);color:var(--g700);border:2px solid var(--g200)}
.btn-secondary:hover{background:var(--g50)}
.btn-ghost{background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:4px;font-size:15px;font-weight:600;color:var(--g500);font-family:inherit}
.btn-ghost:hover{color:var(--g700)}
.btn-ghost-red{background:none;border:none;cursor:pointer;display:flex;align-items:center;gap:4px;font-size:15px;font-weight:600;color:var(--red);font-family:inherit}
.wz-footer{background:var(--white);border-top:1px solid var(--g200);position:sticky;bottom:0}
.wz-footer-inner{max-width:640px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;padding:12px 20px}
.wz-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.4);display:flex;align-items:center;justify-content:center;z-index:50;padding:20px;animation:fadeIn .2s}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.wz-modal{background:var(--white);border-radius:16px;max-width:420px;width:100%;padding:24px;position:relative;box-shadow:0 20px 60px rgba(0,0,0,0.15);animation:scaleIn .2s}
@keyframes scaleIn{from{transform:scale(.95);opacity:0}to{transform:scale(1);opacity:1}}
.wz-modal-close{position:absolute;top:12px;right:12px;background:none;border:none;cursor:pointer;color:var(--g400)}
.wz-modal h3{font-weight:800;color:var(--g900);font-size:19px;margin-bottom:2px}
.wz-modal>p{font-size:14px;color:var(--g500);margin-bottom:20px}
.wz-field{margin-bottom:14px}
.wz-field label{display:block;font-size:13px;font-weight:600;color:var(--g700);margin-bottom:4px}
.wz-field input,.wz-field textarea{width:100%;border:1px solid var(--g200);border-radius:8px;padding:10px 12px;font-size:15px;outline:none;font-family:inherit}
.wz-field input:focus,.wz-field textarea:focus{border-color:var(--red)}
.wz-field textarea{resize:vertical}
.wz-success{text-align:center;padding:20px 0}
.wz-success h3{margin-bottom:4px}
.wz-success p{font-size:14px;color:var(--g500)}
.wz-form-error{background:#fef2f2;border:1px solid #fca5a5;border-radius:8px;padding:10px;margin-bottom:14px;font-size:13px;color:#991b1b;display:none}
.wz-disclaimer-sm{font-size:12px;color:var(--g400);text-align:center;margin-top:16px}
@media(max-width:480px){
 .wz-welcome h1{font-size:23px}
 .wz-question{font-size:19px}
 .wz-actions{flex-direction:column}
 .wz-actions .btn{width:100%}
}
</style>
</head>
<body>

<header class="wz-header">
 <div class="wz-header-inner">
  <div class="wz-logo">
   <div class="wz-logo-icon"><img src="ip-topics.png" alt="IP Topics"></div>
   <div class="wz-logo-text">
    <div>IP Topics</div>
    <div>Wizard proprietà intellettuale</div>
   </div>
  </div>
  <button class="wz-restart" id="headerRestart" style="display:none" onclick="restart()">
   <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path><path d="M3 3v5h5"></path></svg>
   Ricomincia
  </button>
 </div>
 <div class="wz-progress-track" id="progressTrack" style="display:none">
  <div class="wz-progress-bar" id="progressBar" style="width:0%"></div>
 </div>
</header>

<main class="wz-main">
 <div class="wz-card" id="wizardContent"></div>
</main>

<footer class="wz-footer" id="wizardFooter" style="display:none">
 <div class="wz-footer-inner" id="footerInner"></div>
</footer>

<div class="wz-overlay" id="modal" style="display:none">
 <div class="wz-modal" id="modalContent"></div>
</div>

<script>
/* ===== EMAILJS CONFIG ===== */
var EMAILJS_PUBLIC_KEY = 'KNsMwn_XXqxztKB7U';
var EMAILJS_SERVICE_ID = 'service_lwk6s4j';
var EMAILJS_TEMPLATE_ID = 'template_g5lwe5a';

/* ===== DATA ===== */
const STEPS = [
 {id:'welcome',type:'welcome'},
 {id:'situation',question:'In cosa possiamo aiutarti oggi?',subtitle:'Scegli lo scenario che descrive meglio la tua situazione: il percorso si adatta.',type:'single',
  options:[
   {value:'create',label:'Sto creando qualcosa e voglio proteggerlo',desc:'Vuoi prevenire problemi prima di pubblicare o lanciare.'},
   {value:'formalize',label:'Voglio registrare/tutelare un mio asset',desc:'Hai già qualcosa e vuoi formalizzare la protezione.'},
   {value:'contract',label:'Devo firmare o negoziare una licenza/contratto',desc:'NDA, licenze, cessioni, collaborazioni, lavori su commissione.'},
   {value:'violation',label:'Qualcuno sta usando qualcosa che mi appartiene',desc:'Uso non autorizzato di brand, contenuti, design, software, ecc.'},
   {value:'strategy',label:'Voglio una strategia IP (monetizzare / espandermi)',desc:'Piano di tutela, mercati, portafoglio e priorità.'},
   {value:'unsure',label:'Non sono sicuro',desc:'Nessun problema: ti guidiamo con poche domande.'}
  ]},
 {id:'what',question:'Che cosa riguarda?',subtitle:'Seleziona l\'asset o l\'ambito principale (puoi affinare dopo).',type:'single',
  showIf:function(a){return a.situation!=='unsure';},
  options:[
   {value:'name_logo',label:'Brand o segno distintivo',desc:'Nome, logo, slogan e anche segni non tradizionali (suono, movimento, forma, colore, pattern).'},
   {value:'digital_assets',label:'Asset digitali (avatar, skin, oggetti virtuali, metaverso)',desc:'Personaggi, oggetti 3D, wearable virtuali, ambienti, collezionabili digitali.'},
   {value:'design',label:'Design o aspetto (fisico o digitale)',desc:'Forma, linee, colori, UI/iconografia, look & feel di un oggetto o interfaccia.'},
   {value:'creative',label:'Contenuti creativi',desc:'Testi, immagini, foto, musica, video, podcast, format, illustrazioni.'},
   {value:'software_ai',label:'Software / AI / dati',desc:'Codice, app, SaaS, modelli AI, dataset, API, algoritmi.'},
   {value:'invention',label:'Invenzione tecnica o processo',desc:'Soluzione tecnica nuova: meccanismo, formula, metodo industriale.'},
   {value:'secret',label:'Know\u2011how e segreti aziendali',desc:'Ricette, processi, liste clienti, strategie, parametri, configurazioni interne.'},
   {value:'domain',label:'Dominio o username online',desc:'Nome a dominio, handle social, cybersquatting o imitazioni.'},
   {value:'image_voice',label:'Immagine/identità/voce',desc:'Nome persona, immagine, voce clonata, personaggio (reale o virtuale).'},
   {value:'unsure',label:'Non sono sicuro / altro',desc:'Ti diamo un orientamento e i prossimi passi.'}
  ]},
 {id:'abuse_type',question:'Che tipo di abuso sospetti?',subtitle:'Ci aiuta a consigliarti l\'azione più efficace (takedown, diffida, raccolta prove).',type:'single',
  showIf:function(a){return a.situation==='violation';},
  options:[
   {value:'abuse_copyright',label:'Copia di contenuti (copyright)',desc:'Testi, immagini, video, musica, codice, asset creativi copiati o ripubblicati.'},
   {value:'abuse_trademark',label:'Uso di marchio / rischio confusione',desc:'Nome, logo o segno usato per far credere che sia te o collegato a te.'},
   {value:'abuse_counterfeit',label:'Contraffazione prodotto / design',desc:'Prodotti imitati, packaging simile, look copiato.'},
   {value:'abuse_impersonation',label:'Impersonation / deepfake / identità',desc:'Profili falsi, clonazione voce/immagine, annunci ingannevoli.'},
   {value:'abuse_cybersquatting',label:'Cybersquatting (domini/username)',desc:'Domini o handle registrati per bloccare o sfruttare il tuo nome.'},
   {value:'abuse_unsure',label:'Non sono sicuro',desc:'Descriveremo il caso in modo guidato.'}
  ]},
 {id:'owner',question:'Chi ha creato o commissionato l\'asset?',subtitle:'Serve per capire chi è titolare dei diritti (e se servono cessioni/licenze).',type:'single',
  showIf:function(a){return a.situation!=='unsure';},
  options:[
   {value:'owner_self',label:'Io (persona fisica)',desc:'Ho creato io direttamente.'},
   {value:'owner_company',label:'La mia società',desc:'Creato nel contesto aziendale o per l\'azienda.'},
   {value:'owner_team',label:'Team interno / dipendenti',desc:'Creato da persone interne (ruoli diversi).'},
   {value:'owner_freelance',label:'Freelance / consulente',desc:'Creato su commissione da un esterno.'},
   {value:'owner_agency',label:'Agenzia / studio',desc:'Creato da un fornitore strutturato.'},
   {value:'owner_multi',label:'Più soggetti / co-autori',desc:'Ci sono più contributi creativi o accordi.'},
   {value:'owner_unsure',label:'Non sono sicuro',desc:'Meglio chiarirlo prima di investire o pubblicare.'}
  ]},
 {id:'tm_type',question:'Che tipo di marchio vuoi proteggere?',subtitle:'Non esiste solo nome e logo: anche suoni, animazioni e forme possono essere protetti come segni distintivi.',type:'single',
  showIf:function(a){return a.what==='name_logo';},
  options:[
   {value:'word',label:'Nome / parola (marchio denominativo)',desc:'Il nome in sé, anche senza un logo specifico.'},
   {value:'logo',label:'Logo / simbolo (figurativo)',desc:'Il segno grafico o l\'icona.'},
   {value:'combined',label:'Nome + logo (combinato)',desc:'La versione completa come appare al pubblico.'},
   {value:'sound',label:'Sonoro (jingle, sound logo)',desc:'Un suono riconoscibile collegato al brand.'},
   {value:'motion',label:'Movimento / animazione / multimedia',desc:'Una breve animazione o sequenza (anche con audio).'},
   {value:'shape',label:'3D / forma del prodotto o packaging',desc:'La forma come segno distintivo (non il solo design estetico).'},
   {value:'color',label:'Colore, pattern, posizione',desc:'Colore specifico, motivo ripetuto o posizionamento particolare.'},
   {value:'unsure_tm',label:'Non sono sicuro',desc:'Ti aiutiamo a scegliere la strategia più efficace.'}
  ]},
 {id:'tm_use',question:'Hai già iniziato a usare questo segno pubblicamente?',subtitle:'Per uso pubblico intendiamo: sito, social, app, packaging, marketplace, ADV. Se non hai iniziato, puoi pianificare il deposito prima del lancio.',type:'single',
  showIf:function(a){return a.what==='name_logo';},
  options:[
   {value:'use_no',label:'No, non ancora',desc:'Non è ancora visibile al pubblico (o lo è in modo molto limitato).'},
   {value:'use_yes',label:'Sì, lo sto già usando',desc:'È già online/offline (sito, social, app, packaging, ADV, marketplace).'},
   {value:'use_unsure',label:'Non sono sicuro',desc:'Non so cosa conti come uso pubblico: chiariremo nel riepilogo.'}
  ]},
 {id:'design_category',question:'Che tipo di design vuoi proteggere?',subtitle:'Serve solo per mostrarti esempi e pianificare varianti: le categorie sono molto ampie.',type:'single',
  showIf:function(a){return a.what==='design';},
  options:[
   {value:'product',label:'Prodotto (oggetto fisico)',desc:'Qualsiasi oggetto: arredo, accessori, elettronica, utensili, moda, componenti, ecc.'},
   {value:'packaging',label:'Packaging / etichetta',desc:'Confezioni, bottiglie, scatole, label, sleeve.'},
   {value:'surface',label:'Ornamento / pattern / texture',desc:'Motivi, superfici, decorazioni applicate (es. trama, stampa, pattern).'},
   {value:'ui',label:'Interfaccia / icone / UI digitale',desc:'Schermate app, icone, elementi UI quando si tutela l\'aspetto.'},
   {value:'other_design',label:'Altro / non so',desc:'Ti guidiamo con esempi e domande successive.'}
  ]},
 {id:'design_models',question:'Quanti modelli/varianti vuoi includere nello stesso deposito?',subtitle:'Molti sistemi consentono depositi multipli: utile per coprire serie, colorazioni e versioni. Se sei incerto, scegli la stima più realistica.',type:'single',
  showIf:function(a){return a.what==='design';},
  options:[
   {value:'one',label:'Un solo modello',desc:'Un singolo design principale.'},
   {value:'few',label:'2\u20135 modelli/varianti',desc:'Una piccola famiglia di varianti (colori, finiture, dettagli).'},
   {value:'many',label:'Più di 5 (collezione/serie)',desc:'Molte varianti o modelli correlati.'},
   {value:'unsure_dm',label:'Non sono sicuro',desc:'Ti suggeriamo una strategia a tappe.'}
  ]},
 {id:'public',question:'Hai già divulgato pubblicamente ciò che vuoi proteggere?',subtitle:'La divulgazione può influenzare i diritti disponibili.',type:'single',
  showIf:function(a){return a.what==='design'||a.what==='invention';},
  options:[
   {value:'no',label:'No, è ancora riservato',desc:'Non è stato mostrato, pubblicato o offerto al pubblico.'},
   {value:'less_12',label:'Sì, da meno di 12 mesi',desc:'Per i design UE potresti avere ancora margine (periodo di grazia).'},
   {value:'more_12',label:'Sì, da più di 12 mesi',desc:'Alcune strade potrebbero essere precluse.'},
   {value:'unsure_pub',label:'Non sono sicuro',desc:'Lo verificheremo insieme.'}
  ]},
 {id:'registered',question:'Hai già registrazioni o depositi IP attivi?',subtitle:'Sapere da dove parti ci aiuta a consigliarti meglio.',type:'single',
  options:[
   {value:'yes_reg',label:'Sì, ho registrazioni attive',desc:'Marchi, brevetti, design o altro già depositati.'},
   {value:'pending',label:'Domande in corso (depositate)',desc:'Hai già depositato ma la registrazione non è ancora concessa.'},
   {value:'no_reg',label:'No, parto da zero',desc:'Nessun deposito effettuato finora.'},
   {value:'unsure_reg',label:'Non so / devo verificare',desc:'Può capitare: verificheremo insieme.'}
  ]},
 {id:'channel',question:'Dove sta avvenendo l\'abuso?',subtitle:'Il canale cambia le azioni pratiche (segnalazione piattaforma, registrar, diffida, ecc.).',type:'single',
  showIf:function(a){return a.situation==='violation';},
  options:[
   {value:'ch_social',label:'Social network',desc:'Profili, post, reel, video, account falsi.'},
   {value:'ch_market',label:'Marketplace / e\u2011commerce',desc:'Inserzioni, schede prodotto, venditori su piattaforme.'},
   {value:'ch_website',label:'Sito web',desc:'Sito proprio o altrui, blog, vetrina, landing page.'},
   {value:'ch_appstore',label:'App store',desc:'App, giochi o contenuti su store.'},
   {value:'ch_domain',label:'Dominio / hosting / registrar',desc:'Il problema è nel dominio o nell\'infrastruttura.'},
   {value:'ch_ads',label:'Annunci / advertising',desc:'Ads su social, search o reti pubblicitarie.'},
   {value:'ch_unsure',label:'Non sono sicuro',desc:'Posso indicare un percorso prudente.'}
  ]},
 {id:'platform_reported',question:'Hai già inviato una segnalazione al canale/piattaforma?',subtitle:'Se sì, possiamo ragionare su follow\u2011up ed escalation. Se no, spesso è il primo passo più rapido.',type:'single',
  showIf:function(a){return a.situation==='violation' && a.channel && a.channel!=='ch_unsure';},
  options:[
   {value:'rep_no',label:'No, non ancora',desc:'Non ho ancora aperto ticket/segnalazione sulla piattaforma o presso il canale.'},
   {value:'rep_yes',label:'Sì, ho già segnalato',desc:'Ho già inviato una segnalazione o un reclamo (anche se non ha funzionato).'},
   {value:'rep_unsure',label:'Non sono sicuro',desc:'Non so se quello che ho fatto conta come segnalazione ufficiale.'}
  ]},
 {id:'evidence',question:'Hai già prove o materiali utili?',subtitle:'Soprattutto in caso di violazione: un kit prove ordinato fa la differenza.',type:'multi',
  showIf:function(a){return a.situation==='violation';},
  options:[
   {value:'ev_urls',label:'Link/URL e screenshot',desc:'URL, screenshot con data/ora, post, pagine prodotto.'},
   {value:'ev_files',label:'File originali / sorgenti',desc:'File di lavoro, sorgenti, PSD, repository, export 3D.'},
   {value:'ev_dates',label:'Date e cronologia',desc:'Quando hai creato/pubblicato/venduto per la prima volta.'},
   {value:'ev_sales',label:'Fatture / ordini / prove di vendita',desc:'Ordini, fatture, spedizioni, analytics.'},
   {value:'ev_messages',label:'Messaggi / accordi',desc:'Email, chat, NDA, contratti, brief.'},
   {value:'none_evidence',label:'Non ancora / niente di pronto',desc:'Posso dirti cosa raccogliere come primo passo.'}
  ]},
 {id:'territory',question:'In quali territori ti serve protezione?',subtitle:'Spesso la tutela è territoriale, ma online può servirti una copertura globale (domini, social, marketplace).',type:'multi',
  options:[
   {value:'italy',label:'Solo Italia',desc:'Protezione limitata al territorio italiano.'},
   {value:'eu',label:'Unione Europea',desc:'Una sola procedura può coprire più Paesi UE (a seconda del diritto).'},
   {value:'international',label:'Internazionale (fuori UE)',desc:'Strategie e procedure per coprire più Paesi extra\u2011UE.'},
   {value:'online_global',label:'Globale (online/web)',desc:'Rischio ovunque: domini, social, app store, marketplace e contenuti digitali.'},
   {value:'unsure_terr',label:'Non ancora deciso',desc:'Ti aiutiamo a scegliere in base a mercati, produzione e rischi.'}
  ]},
 {id:'goal',question:'Qual è il tuo obiettivo principale?',subtitle:'Puoi selezionarne più di uno.',type:'multi',
  options:[
   {value:'protect',label:'Proteggere / registrare',desc:'Ottenere un diritto esclusivo sui miei asset.'},
   {value:'monetize',label:'Monetizzare / concedere licenze',desc:'Generare ricavi dalla mia proprietà intellettuale.'},
   {value:'defend',label:'Difendermi da una violazione',desc:'Fermare chi usa la mia IP senza autorizzazione.'},
   {value:'negotiate',label:'Negoziare o redigere contratti',desc:'NDA, licenze, cessioni, accordi di coesistenza.'},
   {value:'audit',label:'Fare il punto sulla mia situazione IP',desc:'Capire cosa ho, cosa manca e cosa scade.'},
   {value:'unsure_goal',label:'Non sono sicuro',desc:'Posso darti un orientamento e una lista di prossimi passi.'}
  ]},
 {id:'urgency',question:'C\'è urgenza?',subtitle:'Alcune situazioni richiedono azioni tempestive per non perdere diritti.',type:'single',
  options:[
   {value:'urgent',label:'Sì, è urgente',desc:'Violazione in corso, scadenza imminente, lancio prodotto.'},
   {value:'medium',label:'Entro qualche settimana',desc:'Ho bisogno di muovermi ma non è un\'emergenza.'},
   {value:'no_rush',label:'Nessuna fretta, sto esplorando',desc:'Voglio capire le opzioni con calma.'}
  ]},
 {id:'summary',type:'summary'}
];

const LABELS={
  situation:'Situazione',
  create:'Sto creando e voglio proteggere',
  formalize:'Voglio registrare/tutelare',
  contract:'Contratti e licenze',
  violation:'Violazione / uso non autorizzato',
  strategy:'Strategia IP',
  unsure:'Non sono sicuro',
  what:'Ambito/asset',
  name_logo:'Brand o segno distintivo',
  digital_assets:'Asset digitali (avatar/skin/metaverso)',
  design:'Design o aspetto',
  creative:'Contenuti creativi',
  software_ai:'Software / AI / dati',
  invention:'Invenzione tecnica',
  secret:'Know\u2011how / segreti aziendali',
  domain:'Dominio o username',
  image_voice:'Immagine/identità/voce',
  tm_type:'Tipo di marchio',
  tm_use:'Uso pubblico del segno',
  use_no:'Non ancora in uso',
  use_yes:'Già in uso',
  use_unsure:'Non sono sicuro',
  word:'Nome / parola',
  logo:'Logo / simbolo',
  combined:'Nome + logo',
  sound:'Marchio sonoro',
  motion:'Marchio di movimento/multimedia',
  shape:'Marchio 3D / forma',
  color:'Colore / pattern / posizione',
  unsure_tm:'Non sono sicuro',
  design_category:'Tipo di design',
  product:'Prodotto fisico',
  packaging:'Packaging / etichetta',
  surface:'Ornamento / pattern / texture',
  ui:'Interfaccia / icone / UI',
  other_design:'Altro / non so',
  design_models:'Modelli/varianti nel deposito',
  one:'1 modello',
  few:'2\u20135 modelli/varianti',
  many:'Più di 5',
  unsure_dm:'Non sono sicuro',
  public:'Divulgazione pubblica',
  no:'No, ancora riservato',
  less_12:'Sì, meno di 12 mesi',
  more_12:'Sì, più di 12 mesi',
  unsure_pub:'Non sono sicuro',
  registered:'Registrazioni o depositi attivi',
  yes_reg:'Sì, registrazioni attive',
  pending:'Domande in corso',
  no_reg:'No, nessuna',
  unsure_reg:'Non so',
  territory:'Territori',
  italy:'Italia',
  eu:'Unione Europea',
  international:'Internazionale',
  online_global:'Globale (online/web)',
  unsure_terr:'Non ancora deciso',
  goal:'Obiettivo',
  protect:'Prevenire copie/imitazioni',
  monetize:'Monetizzare (licenze/royalty)',
  defend:'Agire contro una violazione',
  negotiate:'Negoziare/accordi',
  audit:'Mettere ordine/strategia',
  urgency:'Urgenza',
  urgent:'Urgente (pochi giorni)',
  medium:'A breve (entro 1 mese)',
  no_rush:'Non urgente',
  unsure_goal:'Non sono sicuro',
  abuse_type:'Tipo di abuso',
  abuse_copyright:'Copia contenuti (copyright)',
  abuse_trademark:'Uso marchio / confusione',
  abuse_counterfeit:'Contraffazione prodotto/design',
  abuse_impersonation:'Impersonation / deepfake',
  abuse_cybersquatting:'Cybersquatting (domini/username)',
  abuse_unsure:'Non sono sicuro',
  owner:'Titolarità',
  evidence:'Prove disponibili',
  channel:'Canale dell\'abuso',
  platform_reported:'Segnalazione già inviata',
  rep_no:'Non ancora segnalato',
  rep_yes:'Già segnalato',
  rep_unsure:'Non sono sicuro',
  ch_social:'Social network',
  ch_market:'Marketplace / e\u2011commerce',
  ch_website:'Sito web',
  ch_appstore:'App store',
  ch_domain:'Dominio / hosting / registrar',
  ch_ads:'Annunci / advertising',
  ch_unsure:'Non sono sicuro',
  owner_self:'Io (persona fisica)',
  owner_company:'La mia società',
  owner_team:'Team interno/dipendenti',
  owner_freelance:'Freelance/consulente',
  owner_agency:'Agenzia/studio',
  owner_multi:'Più soggetti/co-autori',
  owner_unsure:'Non sono sicuro',
  ev_urls:'Link/URL e screenshot',
  ev_files:'File originali/sorgenti',
  ev_dates:'Date e cronologia',
  ev_sales:'Fatture/ordini',
  ev_messages:'Messaggi/accordi',
  none_evidence:'Non ancora / niente di pronto'
};

const GUIDES={
 situation:{title:'Come funziona questo percorso',
 content:`Scegliendo la <b>situazione</b> ci aiuti a capire "dove sei nel viaggio":
\u2022 <b>Creazione/Protezione</b> \u2192 prevenire problemi prima di pubblicare o lanciare
\u2022 <b>Registrazione</b> \u2192 formalizzare una tutela già pianificata
\u2022 <b>Contratti/Licenze</b> \u2192 mettere nero su bianco diritti, usi consentiti e compensi
\u2022 <b>Violazione</b> \u2192 fermare un uso non autorizzato e raccogliere prove
\u2022 <b>Strategia</b> \u2192 priorità, mercati, monetizzazione e portafoglio

Il resto delle domande serve a restringere il campo e suggerire i prossimi passi più sensati.`},

 what:{title:'Quali asset puoi tutelare (anche digitali)',
 content:`Oggi la "proprietà intellettuale" copre sia il mondo fisico sia quello digitale.

<b>Brand o segni distintivi</b>: nome, logo, slogan e anche segni non tradizionali (suoni, animazioni/movimenti, forme, colori, pattern).
<b>Asset digitali</b>: avatar, skin, oggetti virtuali, wearable, ambienti 3D, contenuti per metaverso o giochi.
<b>Design/aspetto</b>: forma e look & feel di prodotti, packaging, interfacce (UI), icone.
<b>Contenuti creativi</b>: testi, immagini, foto, musica, video, podcast, illustrazioni, <b>giochi</b> (grafica, musica, trama, dialoghi) e <b>format</b> (struttura espressiva, non la sola idea).
<b>Software/AI/dati</b>: codice, app, SaaS, API, dataset, modelli/soluzioni AI.
<b>Invenzioni</b>: soluzioni tecniche (meccanismi, metodi, processi industriali).
<b>Know\u2011how</b>: informazioni riservate con valore (processi, parametri, liste clienti, strategie).
<b>Domini/username</b>: domini web e handle social (specie se imitativi).
<b>Immagine/voce</b>: identità personale o personaggio (reale o virtuale), uso commerciale, clonazioni.

Se sei indeciso, scegli l'opzione più vicina: si può affinare dopo.`},

 tm_type:{title:'Marchi: tipi tradizionali e non tradizionali',
 content:`Un marchio non è solo un nome o un logo. In alcuni casi si può tutelare anche il modo in cui il brand <i>suona</i>, <i>si muove</i> o <i>si presenta</i>.

<b>Nome (denominativo)</b>: protegge la parola in sé.
<b>Logo (figurativo)</b>: protegge il segno grafico.
<b>Combinato</b>: protegge nome+logo insieme (utile se usi sempre quella versione).
<b>Sonoro</b>: jingle o sound\u2011logo (serve una rappresentazione chiara, ad es. un file audio).
<b>Movimento / multimedia</b>: animazione o sequenza (tipicamente un breve video).
<b>3D / forma</b>: la forma come segno distintivo (diverso dal "design": qui la forma identifica l'origine commerciale).
<b>Colore, pattern, posizione</b>: un colore specifico, un motivo ripetuto o un posizionamento particolare (di solito richiede coerenza d'uso nel tempo).

Tip pratico: se stai ancora scegliendo, spesso conviene depositare almeno <b>nome</b> (e talvolta anche <b>logo</b>), poi valutare estensioni non tradizionali quando il segno è già riconoscibile al pubblico.`},

 design_category:{title:'Design: cosa proteggi davvero (e come scegliere cosa includere)',
 content:`Il design tutela l'<b>aspetto</b> (non la funzione tecnica). Per renderlo utile nella vita reale, pensa in termini di <b>modelli</b>, <b>varianti</b> e <b>mercati</b>.

Prima domanda pratica: stai proteggendo l'aspetto di un <b>prodotto</b>, di un <b>packaging</b>, di una <b>superficie/pattern</b> o di una <b>UI</b>? Le categorie ufficiali esistono, ma sono molto ampie: qui ci interessano solo per darti esempi giusti e farti ragionare su cosa includere.

Quando prepari il materiale, ragiona così: per ogni <b>modello</b> che vuoi coprire crea un set di immagini coerente e "pulito", con più angolazioni/lati, così che l'aspetto sia chiaro e confrontabile. Le varianti che conviene includere sono quelle che hanno valore commerciale (quelle che venderai davvero o che un concorrente copierebbe).

Sui <b>territori</b>: scegli in base ai mercati reali (dove produci, vendi, spedisci, promuovi) e ai canali (retail, e\u2011commerce, marketplace). Se il prodotto cambia spesso, una strategia "a tappe" (prima la versione che lanci subito, poi le successive) è spesso più realistica.`},

 design_models:{title:'Design: quante varianti/modelli includere',
 content:`Molti depositi di design permettono di includere <b>più modelli</b> in una singola domanda (o in domande "a pacchetto"), ma conviene farlo con criterio.

<b>1 modello</b>: ottimo se hai un singolo prodotto "hero" o vuoi partire snello.
<b>2\u20135 modelli</b>: tipico per varianti di colore/finitura/dettaglio; prepara immagini coerenti per ciascuna variante.
<b>>5 modelli</b>: utile per collezioni/serie, ma richiede ordine: nomenclatura, set di viste standard (più angolazioni), e una logica chiara su cosa cambia tra i modelli.

Strategia pratica: scegli le varianti che hanno un reale valore commerciale (quelle che venderai o che un concorrente copierebbe). Le micro\u2011variazioni irrilevanti spesso aumentano costi e complessità senza aumentare la protezione.`},

 public:{title:'Divulgazione: cosa cambia davvero',
 content:`"Divulgare" significa rendere pubblico: post online, demo, fiera, vendita, invio a potenziali clienti senza riservatezza, ecc.

<b>Invenzioni</b>: pubblicare troppo presto può rendere più difficile (o impossibile) ottenere una protezione forte.
<b>Design</b>: in alcuni casi può esserci ancora margine anche dopo la prima pubblicazione, ma non conviene contarci.
<b>Segreti/know\u2011how</b>: se diventa pubblico, smette di essere un segreto.

<b>Mini\u2011checklist pratica</b>:
\u2022 non pubblicare altri dettagli finché non hai deciso una strategia
\u2022 usa NDA/accordi di riservatezza quando condividi con terzi
\u2022 conserva prove di date e versioni (file, email, repository, screenshots).`},

 registered:{title:'Perché chiediamo se hai già registrazioni',
 content:`Serve per evitare doppioni e fare scelte migliori.

<b>Se hai registrazioni attive</b>: possiamo capire copertura, territori, classi/ambiti, e cosa conviene estendere o rafforzare.
<b>Se hai domande in corso</b>: cambiano i tempi e le mosse (ad es. priorità, opposizioni, risposte a rilievi).
<b>Se parti da zero</b>: si ragiona su ordine delle azioni e budget.

Consiglio pratico: tieni un elenco con <b>titoli, date, territori e scadenze</b> (anche un semplice foglio di calcolo).`},

 territory:{title:'Territori e "globale online": come pensarci',
 content:`Molte tutele funzionano per <b>territori</b>: scegli dove ti serve davvero (produzione, vendita, mercati futuri, rischio copie).

Per asset "online" (domini, social, app store, marketplace, contenuti digitali) spesso serve una strategia <b>multi\u2011livello</b>:
\u2022 diritti/registrazioni nei mercati chiave
\u2022 regole e procedure delle piattaforme (segnalazioni, takedown, verifiche)
\u2022 monitoraggio di domini/username simili

In pratica: "globale" descrive il <b>rischio</b>; i passi concreti di tutela si costruiscono per priorità.`},

 goal:{title:'Obiettivo: cosa cambia nel percorso',
 content:`L'obiettivo orienta le scelte:

<b>Proteggere/registrare</b>: selezionare lo strumento giusto e preparare depositi/strategie.
<b>Monetizzare</b>: licenze, royalty, franchising, merchandising, accordi di distribuzione.
<b>Difendersi</b>: prove, diffide, segnalazioni su piattaforme, azioni più strutturate se necessario.
<b>Contratti</b>: chiarire titolarità, ambiti d'uso, durata, esclusiva, corrispettivi, recesso.
<b>Audit/strategia</b>: mettere ordine, definire priorità e roadmap.

Uno stesso caso può avere più obiettivi: per questo puoi selezionarne più di uno.`},

 urgency:{title:'Urgenza: perché lo chiediamo',
 content:`Alcune situazioni sono tempo\u2011sensibili: lanci imminenti, divulgazioni già avvenute, violazioni in corso, scadenze o negoziazioni.

Se è urgente, di solito conviene:
\u2022 <b>bloccare ulteriori divulgazioni</b> (se rilevante)
\u2022 <b>raccogliere prove</b> (screenshot, URL, date, fatture, comunicazioni)
\u2022 scegliere una prima azione "reversibile" (es. segnalazione/takedown o diffida ragionata)

Se non è urgente, possiamo ragionare con più calma su costi/benefici e priorità.`}
};

const RECS={
  protect:{
    name_logo:{title:"Percorso: brand / segno distintivo",text:"Se il valore è nel nome o nel segno, l'obiettivo è ridurre confusione sul mercato e costruire un diritto chiaro e difendibile.",next:[
      "Definisci esattamente il segno e come verrà usato (cosa vede/sente il pubblico)",
      "Fai una verifica di anteriorità/somiglianze prima di investire in comunicazione",
      "Scegli territori e classi in base a dove vendi (anche online) e cosa offri"
    ]},
    digital_assets:{title:"Percorso: asset digitali (avatar, skin, oggetti virtuali)",text:"Qui di solito convivono più tutele: opera creativa (asset 2D/3D, audio), design (look), e brand (nome dell'esperienza/prodotto). Conta anche cosa dicono i termini della piattaforma.",next:[
      "Raccogli i file sorgente e le prove di creazione (versioni, date, commit)",
      "Chiarisci diritti tra autori/commissioni/studio (chi possiede cosa)",
      "Valuta tutela per nome/brand e per asset principali, e regole della piattaforma"
    ]},
    design:{title:"Percorso: design / aspetto (fisico o digitale)",text:"La tutela del design riguarda l'aspetto: forma, linee, colori, decorazioni e look complessivo (anche digitale).",next:[
      `Raccogli immagini/render e varianti: cosa è davvero "caratterizzante"`,
      "Gestisci le divulgazioni: se devi mostrare a terzi usa NDA dove serve e conserva prove (date, versioni, materiali)",
      "Decidi territori in base a mercati e canali (fisico + online)"
    ]},
    creative:{title:"Percorso: contenuti creativi",text:"Per contenuti creativi la priorità è attribuzione e prova: dimostrare paternità, data e catena dei diritti (autori, licenze e permessi di utilizzo).",next:[
      "Metti ordine su file originali, date e contratti con collaboratori",
      "Mappa eventuali parti di terzi (musiche, font, stock) e relative licenze",
      "Se pubblichi online, prepara un kit di prove (URL, screenshot, versioni)"
    ]},
    software_ai:{title:"Percorso: software / AI / dati",text:"Spesso la tutela migliore è combinata: codice e documentazione come opera, know\u2011how come riservatezza, e contratti/licenze per lo sfruttamento. Per AI e dati conta molto la provenienza e la catena dei diritti (fonti, licenze, contributi).",next:[
      "Inventaria: codice, eventuali dati/modelli (se presenti), documentazione e componenti esterne",
      "Chiarisci proprietà: dipendenti, freelance, repo, licenze open source",
      "Se serve, definisci NDA e policy interne per proteggere ciò che resta segreto"
    ]},
    invention:{title:"Percorso: invenzione tecnica",text:"Se la soluzione è tecnica, la riservatezza prima del deposito è spesso cruciale. Anche qui serve chiarezza: cosa è nuovo, cosa è già noto, e qual è il vantaggio tecnico.",next:[
      "Documenta la soluzione (problema \u2192 soluzione \u2192 vantaggio) con disegni e varianti",
      "Evita divulgazioni non necessarie e usa NDA in trattative e con fornitori",
      "Valuta mercati/tempi: priorità e budget influenzano la strategia"
    ]},
    secret:{title:"Percorso: know\u2011how / segreto",text:"Qui la tutela nasce soprattutto da misure organizzative: accessi, policy, NDA e tracciamento. Se non è davvero riservato, diventa difficile difenderlo.",next:[
      "Definisci cosa è segreto e chi può accedervi (minimo necessario)",
      "Usa NDA e clausole contrattuali coerenti con processi reali",
      "Implementa misure pratiche: watermark, access logs, repository e permessi"
    ]},
    domain:{title:"Percorso: dominio / username online",text:"Per i nomi online l'esigenza può diventare globale: sul web le imitazioni viaggiano in fretta. La protezione combina brand, prova d'uso e azioni rapide sui canali dove avviene l'abuso.",next:[
      "Raccogli prove (URL, date, screenshot) e verifica chi controlla dominio/account",
      "Allinea il naming (domini, handle, store) con il tuo brand",
      "Se operi su più mercati (o prevedi crescita), imposta priorità: piattaforme principali e Paesi dove ti fanno più danno"
    ]},
    image_voice:{title:"Percorso: immagine / identità / voce",text:"Quando è in gioco una persona (reale o virtuale), spesso entrano diritti della personalità, contratti e, a volte, brand. È importante distinguere uso commerciale, satira, fan-art e clonazioni.",next:[
      "Raccogli prove dell'uso (clip/audio, URL, date, contesto e claim commerciali)",
      "Definisci cosa autorizzi e cosa no (linee guida, licenze, limiti)",
      "Se è un progetto continuativo, valuta anche protezione del nome come brand"
    ]},
    unsure:{title:"Orientamento iniziale",text:"Se non sei sicuro della categoria, partiamo dall'uso reale: dove viene sfruttato, da chi, e con che rischio. Da lì scegliamo la tutela più efficace.",next:[
      "Descrivi in una frase cosa hai creato e dove verrà usato/venduto",
      "Raccogli materiali (file, screenshot, date) e chi è coinvolto (autori/partner)",
      "Definisci priorità: prevenzione, registrazione, monetizzazione o difesa"
    ]}
  },
  contract:{
    default:{title:"Percorso: contratti e licenze",text:"Quando c'è un contratto, la domanda chiave è: chi possiede cosa, per quanto tempo, dove, e con quali limiti. Qui gli errori costano più della burocrazia.",next:[
      "Elenca asset coinvolti (brand, contenuti, codice, dati) e titolarità attuale",
      "Definisci: territorio, durata, esclusiva, canali, sub-licenza, royalty",
      "Controlla clausole su AI/dati, open source, recesso e responsabilità"
    ]}
  },
  violation_abuse:{
    abuse_copyright:{title:"Violazione: copia contenuti",text:"Quando si tratta di copia di contenuti, la chiave è dimostrare paternità, data e somiglianza. Il canale (social, sito, marketplace) determina la via più rapida.",next:[
      "Conserva file originali e una timeline (creazione/pubblicazione)",
      "Raccogli URL e screenshot completi (con data/ora)",
      "Scegli un primo passo: segnalazione/takedown o contatto formale"
    ]},
    abuse_trademark:{title:"Violazione: uso di marchio / confusione",text:"Qui conta la confusione: stesso segno (o simile) usato per intercettare i tuoi clienti. Prove del contesto e del canale aumentano l'efficacia delle azioni.",next:[
      "Raccogli esempi di confusione (messaggi, commenti, annunci)",
      "Documenta come appare il segno e in quali prodotti/servizi è usato",
      "Avvia una prima azione proporzionata: segnalazione/takedown o diffida"
    ]},
    abuse_counterfeit:{title:"Violazione: imitazione/contraffazione (prodotto o design)",text:"Quando il problema è l'imitazione del look o del prodotto, servono confronti chiari e, spesso, una prova d'acquisto o materiale del venditore. Il canale (marketplace/negozio) cambia la strategia.",next:[
      "Raccogli inserzioni, foto, prezzi e identità del venditore",
      "Valuta un acquisto test (se ha senso) e conserva tutto",
      "Scegli azioni sul canale e prepara un confronto dei punti distintivi"
    ]},
    abuse_impersonation:{title:"Violazione: impersonation / deepfake",text:"Qui l'urgenza è spesso alta: l'obiettivo è ridurre danni reputazionali e truffe. Il primo passo tipico è bloccare o far rimuovere account/annunci, mentre conservi prove complete.",next:[
      "Segnala subito su piattaforme (account falso/annuncio/truffa)",
      "Conserva prove complete (URL, screenshot, date, account)",
      "Rafforza canali ufficiali (bio, verifica, link, avvisi) per ridurre confusione"
    ]},
    abuse_cybersquatting:{title:"Violazione: cybersquatting (domini/username)",text:"Il web è globale ma le leve pratiche sono spesso per piattaforma/registrar. Proteggere il nome in modo coerente (brand + domini + handle) riduce il rischio di ricatti e confusione.",next:[
      "Metti in sicurezza domini e username principali (anche varianti ragionevoli)",
      "Raccogli prove su traffico/confusione e dati del dominio/handle",
      "Valuta azioni su registrar/piattaforme e una strategia di marchio nei mercati chiave"
    ]},
    abuse_unsure:{title:"Violazione: triage guidato",text:"Se non è chiaro il tipo di abuso, conviene partire da prove e canale. Con 2\u20133 elementi (cosa, dove, da quando) si sceglie l'azione più efficace.",next:[
      "Raccogli URL/screenshot e una timeline minima",
      "Identifica il canale principale (social, marketplace, sito, app store)",
      "Poi scegli: segnalazione/takedown, contatto formale, o escalation"
    ]}
  },
  violation:{
    default:{title:"Percorso: violazione in corso",text:"Se qualcuno usa qualcosa di tuo, serve agire con calma ma velocemente: prove, canale/piattaforma, e una prima azione proporzionata (spesso reversibile).",next:[
      "Raccogli prove complete (URL, screenshot, date, vendite, messaggi, account)",
      "Identifica il canale: marketplace, social, sito, app store, negozio fisico",
      "Scegli un'azione iniziale: segnalazione/takedown, diffida ragionata, negoziazione"
    ]},
    domain:{title:"Violazione: domini/username/cybersquatting",text:"Qui la scala è spesso globale: una strategia efficace parte dalle piattaforme e dai mercati dove l'abuso ti danneggia davvero.",next:[
      "Raccogli prove e dati WHOIS/registrar dove possibile",
      "Mappa priorità: dove stai perdendo clienti (paesi + piattaforme)",
      "Avvia azioni sul canale (provider/piattaforma) e valuta opzioni per il nome"
    ]},
    name_logo:{title:"Violazione: brand / segno distintivo",text:"L'obiettivo è ridurre confusione e bloccare l'uso che intercetta i tuoi clienti. Prove e contesto (settore/canale) fanno la differenza.",next:[
      "Prove + confronto: come appare il segno e in che contesto viene usato",
      "Valuta rischio confusione (stesso settore/canale) e priorità di intervento",
      "Azione iniziale: segnalazione/takedown o diffida calibrata"
    ]},
    creative:{title:"Violazione: contenuti (copyright)",text:"Per contenuti copiati, la prova di paternità e la catena delle licenze è la parte più importante. Poi si agisce sul canale che distribuisce.",next:[
      "Raccogli originali + date + prove di pubblicazione",
      "Verifica eventuali licenze/usi consentiti (collaboratori, stock, piattaforme)",
      "Azione: segnalazione, richiesta rimozione, e valutazione danno/negoziazione"
    ]}
  }
};


function getRec(a){
  var s=a.situation||'create';
  var w=a.what||'unsure';
  var terr=Array.isArray(a.territory)?a.territory:[];
  var tm=a.tm_type||'';
  var tm_use=a.tm_use||'';
  var abuse=a.abuse_type||'';
  var channel=a.channel||'';
  var reported=a.platform_reported||'';
  var owner=a.owner||'';
  var evidence=Array.isArray(a.evidence)?a.evidence:[];
  var dcat=a.design_category||'';
  var dcount=a.design_models||'';
  var pub=a.public||'';

  var base = (s==='violation')
    ? ((abuse && RECS.violation_abuse && RECS.violation_abuse[abuse]) || (RECS.violation[w]||RECS.violation.default))
    : (s==='contract')
      ? (RECS.contract[w]||RECS.contract.default)
      : (RECS.protect[w]||RECS.protect.unsure);

  var rec = {title: base.title, text: base.text, next: (base.next||[]).slice()};

  if(owner==='owner_freelance' || owner==='owner_agency' || owner==='owner_multi'){
    rec.next.unshift("Verifica titolarità e diritti: in questi casi spesso servono <b>contratti/cessioni/licenze</b> ben scritti prima di pubblicare o far valere l'IP.");
  } else if(owner==='owner_unsure'){
    rec.next.unshift("Chiarisci prima <b>chi è il titolare</b> (persona/società/co\u2011autori): evita sorprese quando devi registrare, licenziare o far valere i diritti.");
  }

  if(s==='violation' && abuse){
    var abuseLabel = (LABELS[abuse]||'');
    if(abuseLabel) rec.text += ' Tipo di abuso indicato: <b>'+abuseLabel+'</b>.';
    if(abuse==='abuse_cybersquatting'){
      rec.next.unshift("Metti in sicurezza subito <b>domini</b> e <b>username</b> principali (anche varianti), e documenta confusione/traffico perso.");
    } else if(abuse==='abuse_impersonation'){
      rec.next.unshift("Segnala rapidamente il profilo/annuncio per <b>impersonation</b> e conserva prove complete (URL, screenshot, date, account).");
    } else if(abuse==='abuse_trademark'){
      rec.next.unshift("Raccogli esempi di <b>confusione</b> (commenti, messaggi clienti, annunci) e prova a collegare l'uso al canale/settore.");
    } else if(abuse==='abuse_counterfeit'){
      rec.next.unshift("Acquisisci prove del prodotto imitato (foto, inserzioni, eventuale acquisto test) e confronta gli elementi distintivi (look/packaging).");
    } else if(abuse==='abuse_copyright'){
      rec.next.unshift("Conserva prova di paternità e data (file originali, versioni, repository) e confronta la copia (parti identiche, tempi, canale).");
    }
  }

  if(s==='violation' && channel){
    var chLabel = (LABELS[channel]||'');
    if(chLabel) rec.text += ' Canale indicato: <b>'+chLabel+'</b>.';
    if(channel==='ch_social'){
      rec.next.unshift("Per i <b>social</b>: segnala contenuti/profili dalla piattaforma e conserva prove (URL, screenshot, data). Se c'è impersonation, usa la procedura dedicata.");
    } else if(channel==='ch_market'){
      rec.next.unshift("Per <b>marketplace</b>: segnala la/e inserzione/i, valuta un acquisto test se serve, e conserva ID inserzione, venditore e prezzi.");
    } else if(channel==='ch_appstore'){
      rec.next.unshift("Per <b>app store</b>: usa i moduli di segnalazione dello store e raccogli prova della pubblicazione (link, versioni, screenshot, descrizioni).");
    } else if(channel==='ch_domain'){
      rec.next.unshift("Se il problema è <b>dominio/hosting</b>: conserva prove, controlla intestazioni (WHOIS se disponibile) e prepara una richiesta strutturata al registrar/host.");
    } else if(channel==='ch_ads'){
      rec.next.unshift("Per <b>annunci</b>: segnala l'ad (librerie annunci e report), salva creatività e landing page, e collega l'ad all'inserzionista quando possibile.");
    } else if(channel==='ch_website'){
      rec.next.unshift("Per <b>siti web</b>: conserva prove complete (URL, screenshot, data) e identifica il soggetto (contatti, società, host) prima di una richiesta formale.");
    }
  }

  if(s==='violation' && reported){
    if(reported==='rep_no'){
      rec.next.unshift("Se non l'hai già fatto, apri subito una <b>segnalazione ufficiale</b> sul canale: spesso è il passo più rapido e crea un numero di pratica.");
    } else if(reported==='rep_yes'){
      rec.next.unshift("Se hai già segnalato: conserva <b>ID ticket</b>, date e risposte. Se non si risolve, passa a un <b>follow\u2011up</b> strutturato (e valuta escalation con una richiesta formale).");
    } else if(reported==='rep_unsure'){
      rec.next.unshift("Verifica se hai usato una procedura <b>ufficiale</b> (ticket/modulo reclami). Se no, conviene aprirla prima di passare a passi più formali.");
    }
  }

  if(s==='violation' && evidence.includes('none_evidence')){
    rec.next.push(`Crea un mini "kit prove": 3\u20135 screenshot con URL e data, i tuoi file originali (o repository), e una timeline (prima pubblicazione/uso).`);
  }

  var terrLabel = function(t){
    if(t==='italy') return 'Italia';
    if(t==='eu') return 'UE';
    if(t==='international') return 'extra\u2011UE';
    if(t==='online_global') return 'online/globale';
    return t;
  };
  var terrPick = function(){
    var t = terr.filter(function(x){return ['italy','eu','international','online_global'].indexOf(x)!==-1;});
    if(!t.length) return '';
    if(t.indexOf('online_global')!==-1 && t.length===1) return 'online/globale';
    return t.map(terrLabel).join(', ');
  };

  var isActionPath = (s!=='violation' && s!=='contract');

  if(isActionPath){
    if(w==='name_logo'){
      var where = terr.indexOf('eu')!==-1 ? 'a livello UE' : (terr.indexOf('italy')!==-1 && terr.indexOf('international')===-1 ? 'in Italia' : (terr.indexOf('international')!==-1 ? 'nei Paesi chiave + eventuale estensione internazionale' : 'nei mercati dove operi'));
      var tipo = tm ? (' (tipo: '+(LABELS[tm]||tm)+')') : '';
      rec.next.unshift('Deposita un <b>marchio</b>'+tipo+' '+where+'.');
      if(tm && tm!=='unsure_tm'){
        rec.text += ' Nel tuo caso: <b>'+(LABELS[tm]||tm)+'</b>.';
      }

      if(tm==='word'){
        rec.next.splice(1,0,"Definisci le varianti del nome che userai davvero (spazi, trattini, maiuscole) e mantieni coerenza tra sito, social e materiali.");
      } else if(tm==='logo' || tm==='combined'){
        rec.next.splice(1,0,`Consolida la versione "ufficiale" del logo (file sorgenti, varianti consentite) e come verrà usato (sito, app, packaging, ADV).`);
      } else if(tm==='sound'){
        rec.next.splice(1,0,"Prepara il file audio del segno (jingle/sound logo) e definisci quando viene usato (app, spot, intro, ecc.).");
      } else if(tm==='motion'){
        rec.next.splice(1,0,`Prepara un breve file video/animazione del segno (anche con audio) e stabilisci la versione "ufficiale" da usare sempre.`);
      } else if(tm==='shape'){
        rec.next.splice(1,0,"Definisci quale forma è davvero distintiva (non solo estetica) e raccogli immagini/render coerenti della forma come segno.");
      } else if(tm==='color'){
        rec.next.splice(1,0,"Definisci colore/pattern in modo preciso e coerente e come viene applicato (posizione, proporzioni, contesto d'uso).");
      }

      if(tm_use==='use_yes'){
        rec.text += " Hai indicato che il segno è già in uso pubblico: è un buon momento per mettere ordine e rendere la tutela più difendibile.";
        rec.next.splice(2,0,"Raccogli prove d'uso (screenshot datati, URL, packaging, ADV, fatture) e usa il segno in modo coerente: ti aiuterà in caso di contestazioni o abusi.");
      } else if(tm_use==='use_no'){
        rec.text += " Hai indicato che non è ancora in uso pubblico: questo ti dà margine per pianificare il deposito prima del lancio.";
        rec.next.splice(2,0,"Se puoi, deposita prima del lancio e coordina sito/social/materiali: riduce il rischio di imitazioni e di dover cambiare nome dopo l'investimento.");
      } else if(tm_use==='use_unsure'){
        rec.next.splice(2,0,`Chiarisci se il segno è già "pubblico" (anche solo una landing o un post): la risposta cambia priorità e tipo di prove da raccogliere.`);
      }
      rec.next.push("Pianifica l'estensione: di solito hai ~<b>6 mesi</b> dal primo deposito per estendere in altri Paesi mantenendo la data di priorità (se ti serve).");
      if(terr.indexOf('online_global')!==-1 || w==='domain'){
        rec.next.push("Allinea subito <b>domini</b>, <b>username</b> e nomi sugli store principali: è la difesa più rapida contro imitazioni/cybersquatting.");
      }
      if(['sound','motion','shape','color'].indexOf(tm)!==-1){
        rec.text += " Nota pratica: i marchi non tradizionali funzionano meglio quando il segno è davvero riconoscibile dal pubblico e rappresentabile in modo chiaro (file audio/video, descrizione del colore/pattern, ecc.).";
      }
    }

    if(w==='design'){
      var where2 = terr.indexOf('eu')!==-1 ? 'in UE' : (terr.indexOf('italy')!==-1 && terr.indexOf('international')===-1 ? 'in Italia' : 'nei mercati dove vendi');
      var cat = dcat ? (' (tipo: '+(LABELS[dcat]||dcat)+')') : '';
      var cnt = dcount ? (' \u2022 modelli/varianti: <b>'+(LABELS[dcount]||dcount)+'</b>') : '';

      if(pub==='more_12'){
        rec.next.unshift('Hai indicato che il design è stato divulgato da <b>oltre 12 mesi</b>: una registrazione del design in UE può essere <b>a rischio di invalidità</b>.');
        rec.next.push("Prima di investire in un deposito, ricostruisci con precisione <b>quando</b> e <b>cosa</b> è stato reso pubblico (foto, schede prodotto, marketplace, fiere, vendite) e conserva prove ordinate.");
        rec.next.push("Strategia pratica spesso efficace: valutare se esiste una <b>nuova versione/variante</b> (anche piccoli cambiamenti visibili) da depositare ora, e in parallelo rafforzare <b>brand</b> e canali (packaging, marchio, domini/handle).");
      } else if(pub==='unsure_pub'){
        rec.next.unshift('Valuta un deposito di <b>design</b>'+cat+' '+where2+'.'+(cnt ? ' '+cnt : ''));
        rec.next.push("Non sei sicuro della divulgazione: prima di depositare, ricostruisci date e materiali pubblici (post, schede, fiere, vendite) per capire se sei ancora nei tempi utili.");
      } else {
        rec.next.unshift('Valuta un deposito di <b>design</b>'+cat+' '+where2+'.'+(cnt ? ' '+cnt : ''));
        rec.next.push("Se prevedi estensioni: per il design la finestra di priorità è spesso ~<b>6 mesi</b> dal primo deposito (utile per espandere a tappe).");
      }

      if(dcount==='many'){
        rec.next.push(`Con molte varianti/modelli: valuta una struttura "a pacchetto" (depositi multipli) o più depositi coordinati, con immagini e nomenclatura molto pulite.`);
      } else if(dcount==='few'){
        rec.next.push("Con 2\u20135 varianti: prepara un set di immagini coerente per ciascun modello (più angolazioni/lati) e definisci chiaramente cosa cambia (finitura, texture, dettagli).");
      }

      if(pub==='no'){
        rec.text += " Hai indicato che non hai divulgato: ottimo, perché ti dà più margine per depositare prima del lancio e scegliere territori/varianti con calma. Evita di pubblicare dettagli finché non hai deciso cosa depositare e dove.";
      } else if(pub==='less_12'){
        rec.text += " Hai indicato una divulgazione recente: in molti casi esiste una finestra limitata per registrare senza che la tua stessa divulgazione ti danneggi. Muoviti presto e conserva prove ordinate (foto/URL/date/versioni).";
      } else if(pub==='more_12'){
        rec.text += " Hai indicato una divulgazione da oltre 12 mesi: la registrazione del design può diventare problematica o impugnabile. In questi casi spesso conviene puntare su nuove varianti depositabili e su strumenti complementari (brand, contratti, canali).";
      } else if(pub==='unsure_pub'){
        rec.text += " Non sei sicuro della data di divulgazione: prima di decidere conviene ricostruire le date (post, fiere, vendite, invii a clienti) e mettere in ordine le prove.";
      }
    }

    if(w==='invention'){
      var where3 = terr.indexOf('eu')!==-1 ? 'tramite deposito europeo' : (terr.indexOf('italy')!==-1 && terr.indexOf('international')===-1 ? 'con un primo deposito in Italia' : 'con una strategia multi\u2011Paese');
      rec.next.unshift("Se l'invenzione è davvero tecnica, valuta un deposito di <b>brevetto</b> "+where3+" (prima di divulgare).");
      rec.next.push("Per estendere in altri Paesi mantenendo la priorità, la finestra tipica è ~<b>12 mesi</b> dal primo deposito.");

      if(pub==='no'){
        rec.text += " Hai indicato che l'idea è ancora riservata: ottimo, perché ti consente di valutare deposito e strategia senza bruciarti opzioni. Evita di pubblicare dettagli tecnici finché non hai deciso il primo deposito.";
      } else if(pub==='less_12' || pub==='more_12'){
        rec.text += " Attenzione: divulgazioni pubbliche possono compromettere la possibilità di brevettare. Se hai dubbi, non pubblicare altro e fai un check rapido su cosa è stato divulgato e quando.";
      } else if(pub==='unsure_pub'){
        rec.text += " Non sei sicuro se/quanto hai divulgato: prima di decidere, ricostruisci cosa è stato reso pubblico (pitch, demo, post, offerte, fiere) e con quali dettagli tecnici.";
      }
    }

    if(w==='creative'){
      rec.next.unshift("Metti in sicurezza la <b>catena dei diritti</b>: chi è autore, cosa è su commissione, cosa è stock/licenziato.");
      rec.next.push("Se il valore è anche nel nome del progetto/canale, valuta di depositare un <b>marchio</b> per evitare appropriazioni.");
    }

    if(w==='software_ai'){
      rec.next.unshift("Protezione tipica: <b>codice</b> (opera), <b>segreti/know\u2011how</b> (processi e metodi interni), e <b>contratti/licenze</b> (clienti, team, provider).");
      if(terr.indexOf('online_global')!==-1){
        rec.next.push(`Scenario online/globale: definisci mercati prioritari e costruisci una protezione "a cerchi concentrici" (core markets \u2192 estensioni).`);
      }
    }

    if(w==='domain'){
      rec.next.unshift("Per proteggere un nome online, di solito serve un mix: <b>domini/handle</b> + (spesso) <b>marchio</b> nei mercati rilevanti.");
      rec.next.push("Se prevedi espansione, pianifica un deposito marchio nei territori principali e un'estensione entro ~<b>6 mesi</b> per mantenere la priorità.");
    }

    if(w==='image_voice'){
      rec.next.unshift("Chiarisci l'uso: commerciale vs editoriale, e conserva prove/contratti (release, autorizzazioni, licenze).");
      rec.next.push("Se l'identità è anche un brand (nome d'arte/personaggio), valuta un <b>marchio</b> per nomi e merchandising.");
    }

    if(w==='secret'){
      rec.next.unshift("Qui la protezione è soprattutto organizzativa: accessi, NDA, policy interne, tracciamento e compartimentazione.");
    }
  }

  var tp = terrPick();
  if(tp){
    rec.text += ' Territori indicati: <b>'+tp+'</b>.';
    if(terr.indexOf('online_global')!==-1){
      rec.text += " Nota: il web è globale, ma i diritti spesso sono territoriali. La strategia pratica è scegliere mercati chiave + agire velocemente sui canali (platform takedown, domini, store).";
    }
  }

  return rec;
}


var IC={
 shield:'<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#C62828" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
 shieldSm:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#C62828" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>',
 arrowR:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>',
 arrowL:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 12H5"/><path d="m12 19-7-7 7-7"/></svg>',
 copy:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="14" height="14" x="8" y="8" rx="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>',
 alert:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></svg>',
 check:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>',
 checkLg:'<svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#16a34a" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><path d="m9 11 3 3L22 4"/></svg>',
 send:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m22 2-7 20-4-9-9-4z"/><path d="m22 2-10 10"/></svg>',
 restart:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>',
 chevron:'<svg class="wz-guide-chevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>',
 book:'<svg class="wz-guide-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>',
 close:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>'
};

var step=0, answers={};

function getVisible(){return STEPS.filter(function(s){return !s.showIf||s.showIf(answers);});}
function cur(){var v=getVisible();if(!v.length) return null;if(step<0) step=0;if(step>=v.length) step=v.length-1;return v[step];}
function totalSteps(){return getVisible().length;}

function canNext(){
 var c=cur();
 if(!c) return false;
 if(c.type==='welcome'||c.type==='summary') return true;
 var v=answers[c.id];
 if(c.type==='single') return !!v;
 if(c.type==='multi') return Array.isArray(v)&&v.length>0;
 return false;
}

function pick(id,val){answers[id]=val;render();}
function toggle(id,val){
  if(!answers[id]) answers[id]=[];
  var exclusiveIds = {territory:1,goal:1,evidence:1};
  var isExclusiveVal = function(v){return typeof v==='string' && (v.indexOf('unsure_')===0 || v==='none_evidence');};
  if(exclusiveIds[id]){
    if(isExclusiveVal(val)){
      answers[id] = [val];
      render();
      return;
    } else {
      answers[id] = answers[id].filter(function(v){return !isExclusiveVal(v);});
    }
  }
  var arr = answers[id];
  var i = arr.indexOf(val);
  if(i===-1) arr.push(val); else arr.splice(i,1);
  render();
}
function goNext(){if(canNext()&&step<totalSteps()-1){step++;render();}}
function goBack(){if(step>0){step--;render();}}
function restart(){step=0;answers={};render();document.getElementById('modal').style.display='none';}

function getLines(){
 var r=[];
 getVisible().forEach(function(s){
   if(s.type==='welcome'||s.type==='summary') return;
   var v=answers[s.id]; if(!v) return;
   var q=LABELS[s.id]||s.question;
   var a=Array.isArray(v)?v.map(function(x){return LABELS[x]||x;}).join(', '):(LABELS[v]||v);
   r.push({q:q,a:a});
 });
 return r;
}

function toastCopy(ok,msg){
  var b=document.getElementById('copyBtn');
  if(!b) return;
  var prev=b.innerHTML;
  b.innerHTML=(ok?IC.check:IC.alert)+' '+(msg|| (ok?'Copiato!':'Impossibile copiare'));
  setTimeout(function(){b.innerHTML=prev;},2500);
}
function copyFallback(text){
  var ta=document.createElement('textarea');
  ta.value=text;
  ta.setAttribute('readonly','');
  ta.style.position='fixed';
  ta.style.top='-1000px';
  ta.style.left='-1000px';
  document.body.appendChild(ta);
  ta.select();
  ta.setSelectionRange(0, ta.value.length);
  var ok=false;
  try{ ok=document.execCommand('copy'); }catch(e){ ok=false; }
  document.body.removeChild(ta);
  return ok;
}


function getLearn(a){
  var sit=a.situation||'';
  var what=a.what||'';
  var terr=Array.isArray(a.territory)?a.territory:[];
  var isOnline = terr.indexOf('online_global')!==-1 || what==='domain' || what==='digital_assets' || what==='software_ai';
  var publicState=a.public||'';
  var pills=[];
  if(sit) pills.push(LABELS[sit]||sit);
  if(what) pills.push(LABELS[what]||what);
  if(isOnline) pills.push('Scenario online / globale');

  var intro = "La proprietà intellettuale non è una bacchetta magica: è un insieme di strumenti diversi. Il trucco è scegliere quello che combacia con il tuo asset e con il rischio reale.";
  if(sit==='violation') intro = "Quando c'è una violazione, la priorità è doppia: (1) bloccare o ridurre il danno, (2) costruire una base di prove e titolarità per reggere nel tempo.";
  if(sit==='contract') intro = "Nei contratti IP il rischio non è perdere una causa, è firmare qualcosa che ti svuota i diritti senza accorgertene. Qui la chiarezza batte la fretta.";
  if(sit==='strategy') intro = "Una strategia IP buona è noiosa in modo virtuoso: priorità, budget, mercati, e un portafoglio coerente. È come mettere cartelli stradali nel caos.";

  var sections = [];
  function add(h,p){sections.push({h:h,p:p});}

  if(what==='name_logo'){
    var tm=a.tm_type||'';
    var tmLbl = tm && tm!=='unsure_tm' ? (LABELS[tm]||tm) : '';
    var s1, s2, s3;
    if(tm==='word'){
      s1 = "Nel tuo caso vuoi proteggere un <b>nome/parola</b>: la forza sta nella coerenza d'uso (sempre lo stesso nome) e nel legame tra nome e ciò che offri.";
    } else if(tm==='logo'){
      s1 = "Nel tuo caso vuoi proteggere un <b>logo</b>: conta avere una versione ufficiale e usarla in modo coerente su sito, social, packaging e materiali.";
    } else if(tm==='combined'){
      s1 = "Nel tuo caso vuoi proteggere un segno <b>nome + logo</b>: utile quando il pubblico riconosce entrambe le componenti insieme.";
    } else if(tm==='sound'){
      s1 = "Nel tuo caso vuoi proteggere un <b>marchio sonoro</b>: funziona quando il suono è davvero associato al brand (jingle, sound logo) e lo usi sempre nello stesso modo.";
    } else if(tm==='motion'){
      s1 = "Nel tuo caso vuoi proteggere un <b>marchio di movimento/multimediale</b>: un'animazione riconoscibile (e spesso ripetuta) che identifica il brand.";
    } else if(tm==='shape'){
      s1 = `Nel tuo caso vuoi proteggere un <b>marchio 3D / di forma</b>: qui la domanda pratica è se il pubblico riconosce quella forma come "il tuo segno", non solo come estetica del prodotto.`;
    } else if(tm==='color'){
      s1 = "Nel tuo caso vuoi proteggere un <b>marchio di colore/pattern/posizione</b>: serve coerenza (stesso colore/pattern nello stesso contesto) e una definizione chiara di come si applica.";
    } else {
      s1 = `Un marchio è un segno che fa dire alle persone "questo viene da loro". Serve a ridurre confusione e imitazioni, e a rendere più semplice intervenire quando qualcuno copia.`;
    }
    add("Che cosa stai proteggendo", s1);
    s2 = `Prima di investire in comunicazione: verifica somiglianze nel tuo settore. Se il segno è "pulito", la mossa più realista è depositare il marchio nel territorio dove venderai per primo, e poi estendere ai mercati successivi.`;
    if(tmLbl) s2 = 'Passo pratico (tipo: <b>'+tmLbl+'</b>): ' + s2;
    add("Mossa pratica che ti evita guai", s2);
    if(tm==='sound' || tm==='motion'){
      s3 = `Creare un jingle/animazione e pensare che sia automaticamente "protetto come marchio". Serve una strategia: uso coerente e, se ti interessa difenderlo come brand, un deposito adatto.`;
    } else {
      s3 = `Pensare che "ho il dominio/handle" equivalga a protezione. Domini e username aiutano, ma il pezzo difensivo più solido è avere un diritto sul segno e usarlo in modo coerente.`;
    }
    add("Errore tipico", s3);
  } else if(what==='digital_assets'){
    add("Che cosa stai proteggendo","Avatar, skin e oggetti virtuali sono spesso un mix: (a) opera creativa (grafica/3D), (b) look ripetibile (design), (c) nome del progetto/personaggio (brand). Capire quale strato ti serve è metà della strategia.");
    add("Mossa pratica che ti evita guai",`Conserva "prove di paternità": file sorgenti, versioni, commit, esportazioni, date. Per la monetizzazione, chiarisci licenze e regole d'uso (cosa possono fare gli utenti, cosa no) e tieni un set di asset ufficiali per riconoscere le copie.`);
    add("Errore tipico","Confondere la tecnologia (NFT, blockchain, piattaforma) con i diritti. Il token non crea automaticamente diritti: i diritti dipendono da chi ha creato l'asset e da cosa è stato concesso per iscritto.");
  } else if(what==='software_ai'){
    add("Che cosa stai proteggendo","Nel software di solito proteggi tre cose diverse: (1) il codice come opera creativa, (2) il know\u2011how come informazione riservata, (3) il valore commerciale tramite contratti e licenze. Per AI e dati il punto critico è la catena dei diritti: fonti, licenze, contributi e policy interne.");
    add("Mossa pratica che ti evita guai","Metti in ordine repository, autorizzazioni e licenze (anche open source). Se collaborano terzi: accordi chiari su titolarità e riuso. Se i dati sono centrali: documenta provenienza e permessi, perché è lì che nascono i problemi grossi.");
    add("Errore tipico","Partire a costruire senza sapere cosa stai incorporando. Un pezzo di codice o dataset con vincoli sbagliati può trasformare una feature in un debito legale.");
  } else if(what==='domain'){
    add("Che cosa stai proteggendo","Domini e username sono indirizzi: utili, ma non sempre diritti. Sul web il rischio è spesso globale (chi ti imita può essere ovunque), mentre la protezione legale si costruisce per territori e canali.");
    add("Mossa pratica che ti evita guai","Strategia realista: blocca subito i canali dove avviene l'abuso (registrar, hosting, social, marketplace) con prove pulite, e in parallelo costruisci una protezione del segno nei mercati che contano per te (dove vendi, dove investirai, dove ti cercano).");
    add("Errore tipico",`Fissarsi su "Italia o UE" quando il problema è distribuito. Online ha senso ragionare per priorità di visibilità e di mercato, non solo per confini geografici.`);
  } else if(what==='design'){
    add("Che cosa stai proteggendo","Il design tutela l'aspetto: linee, forme, texture, ornamentazioni. Non tutela la funzione. Per questo è fondamentale capire cosa rende riconoscibile il tuo prodotto e documentarlo bene (immagini chiare, più viste, dettagli e varianti).");
    add("Mossa pratica che ti evita guai",`Se hai più modelli/varianti, pianifica: quali differenze sono "varianti" e quali sono prodotti distinti? Prepara immagini coerenti e una nomenclatura chiara. Deposita prima dei lanci importanti, e pensa ai Paesi come mercati: dove venderai davvero?`);
    add("Errore tipico","Pubblicare tutto ovunque e poi chiedersi perché le opzioni si restringono. Se puoi, pianifica prima: ordine delle versioni, date, e cosa viene divulgato.");
  } else if(what==='creative'){
    add("Che cosa stai proteggendo","Nel diritto d'autore conta la forma espressiva: testi, foto, video, musica, illustrazioni, UI, ma anche giochi (da tavolo, di carte o di società: regolamento, testi, grafica e componenti creativi), videogiochi (codice + asset) e format quando sono descritti in modo concreto (non la sola idea).");
    add("Mossa pratica che ti evita guai",`Crea un "pacchetto prove": file originali, versioni, esportazioni, date, crediti e contratti con collaboratori. Se usi stock/musiche/template: conserva le licenze. Per videogiochi: mappa chi possiede cosa (audio, 3D, codice, engine, plugin).`);
    add("Errore tipico",`Pensare che "è online quindi è pubblico quindi è libero". No: pubblico non significa libero. Ma devi saper dimostrare paternità e diritti, altrimenti è difficile farli rispettare.`);
  } else if(what==='secret'){
    add("Che cosa stai proteggendo","Il segreto funziona solo se resta segreto: informazioni tecniche, formule, processi, liste clienti, pricing, algoritmi non pubblici. È una tutela potentissima\u2026 ma è anche una disciplina organizzativa.");
    add("Mossa pratica che ti evita guai","Riduci l'accesso (chi serve davvero), usa NDA dove ha senso, traccia consegne e versioni, e crea procedure semplici (watermark, permessi, log). Se entra/esce gente dal team, gestisci bene il passaggio: lì i segreti evaporano.");
    add("Errore tipico",`Trattare il segreto come una "clausola", non come un processo. Senza misure concrete, è come mettere un lucchetto disegnato con la matita.`);
  } else if(what==='image_voice'){
    add("Che cosa stai proteggendo","Quando in gioco ci sono immagine, voce o identità (reale o virtuale), la domanda giusta è: viene usata per far credere un collegamento, un endorsement o un vantaggio commerciale?");
    add("Mossa pratica che ti evita guai","Conserva clip, screenshot, URL e contesto. Segna dove viene usata (pubblicità, profilo fake, contenuto creativo). Se hai un brand personale stabile, naming e linee guida riducono ambiguità e abusi.");
    add("Errore tipico","Confondere satira/contesto creativo con uso commerciale. La risposta corretta dipende molto da come e dove viene usata l'identità.");
  } else if(what==='invention'){
    add("Che cosa stai proteggendo","Per un'invenzione la chiave è descrivere: problema \u2192 soluzione \u2192 vantaggio, con varianti. Non serve poesia: serve chiarezza tecnica e alternative.");
    add("Mossa pratica che ti evita guai","Se l'idea è ancora riservata, proteggi la riservatezza mentre valuti il deposito. Se devi parlarne, usa NDA e tieni traccia di cosa hai condiviso. Pianifica i mercati: territorio, budget e tempi decidono la strategia.");
    add("Errore tipico","Divulgare troppo presto (pitch, fiera, post) e poi scoprire che proteggere diventa più difficile. Meglio una settimana di prudenza che mesi di rimpianti.");
  } else {
    add("Tre leve che funzionano quasi sempre",`Registrazione (quando serve), segreto (quando possibile), e una combinazione di prove & contratti (sempre). L'IP è meno "atto unico" e più "sistema di abitudini".`);
    add("Canali e realtà","Web, marketplace e social hanno regole proprie: spesso la via più rapida per ridurre i danni è agire sul canale giusto con prove ordinate.");
    add("Priorità","Proteggi prima ciò che genera fatturato o rischio reputazionale. Il resto può seguire: la strategia migliore è quella che riesci a mantenere.");
  }

  var disclosureNote = (publicState && publicState!=='no')
    ? "Nota sulla divulgazione: se hai già pubblicato o mostrato l'asset, muoversi presto aiuta. Metti ordine su date e versioni: sono decisive."
    : "Nota sulla divulgazione: se l'asset è ancora riservato, ottimo. Evita condivisioni inutili finché non hai deciso la strategia (e usa NDA dove serve).";

  var pillsHtml = '';
  if(pills.length){
    pillsHtml = '<div class="wz-pillrow">';
    for(var pi=0;pi<pills.length;pi++) pillsHtml += '<span class="wz-pill">'+pills[pi]+'</span>';
    pillsHtml += '</div>';
  }

  var sectionsHtml = '';
  for(var si=0;si<sections.length;si++){
    sectionsHtml += '<div class="wz-learn-sec"><h4>'+sections[si].h+'</h4><p>'+sections[si].p+'</p></div>';
  }

  var onlineNote = isOnline ? "<br><br><span class='k'>Scenario online/globale</span>: anche se registri per territori, puoi agire subito sui canali (piattaforme, hosting, app store) e costruire una strategia per priorità di mercati e visibilità." : "";

  var html = '<details class="wz-accordion"><summary class="wz-accordion-summary">\uD83D\uDCDA Mini\u2011lezione IP: cosa conta davvero nel tuo caso (apri se ti interessa)</summary><div class="wz-learn">'
    + '<h3>Mini\u2011guida: come ragionare sull\'IP (senza farsi fregare)</h3>'
    + '<p>'+intro+'</p>'
    + pillsHtml
    + sectionsHtml
    + '<div class="wz-note">'+disclosureNote+onlineNote+'</div>'
    + '</div></details>';
  return html;
}

function doCopy(){
  var rec = getRec(answers);
  var t = '=== IP TOPICS \u2014 Riepilogo Wizard ===\n\n';
  var lines = getLines();
  for(var i=0;i<lines.length;i++){
    t += lines[i].q+': '+lines[i].a+'\n';
  }
  if(rec){
    t += '\n--- Orientamento ---\n'+rec.title+'\n'+rec.text+'\n\nProssimi passi:\n';
    for(var j=0;j<rec.next.length;j++){
      t += (j+1)+'. '+rec.next[j].replace(/<[^>]*>/g,'')+'\n';
    }
  }
  t += '\n---\nGenerato su iptopics.com';

  (function(){
    if(navigator.clipboard && navigator.clipboard.writeText){
      navigator.clipboard.writeText(t).then(function(){
        toastCopy(true,'Copiato!');
      }).catch(function(){
        var ok2 = copyFallback(t);
        toastCopy(ok2, ok2?'Copiato!':'Copia non disponibile qui');
      });
    } else {
      var ok2 = copyFallback(t);
      toastCopy(ok2, ok2?'Copiato!':'Copia non disponibile qui');
    }
  })();
}


/* ===== MODAL & EMAILJS ===== */
function getWizardSummaryText(){
  var rec = getRec(answers);
  var t = '';
  var lines = getLines();
  for(var i=0;i<lines.length;i++){
    t += lines[i].q+': '+lines[i].a+'\n';
  }
  if(rec){
    t += '\nOrientamento: '+rec.title+'\n'+rec.text.replace(/<[^>]*>/g,'')+'\n\nProssimi passi:\n';
    for(var j=0;j<rec.next.length;j++){
      t += (j+1)+'. '+rec.next[j].replace(/<[^>]*>/g,'')+'\n';
    }
  }
  return t;
}

function showModal(){document.getElementById('modal').style.display='flex';renderModal('form');}
function closeModal(){document.getElementById('modal').style.display='none';}

function sendForm(){
  var mc=document.getElementById('modalContent');
  var nameEl = mc.querySelector('#wz-form-name');
  var emailEl = mc.querySelector('#wz-form-email');
  var phoneEl = mc.querySelector('#wz-form-phone');
  var notesEl = mc.querySelector('#wz-form-notes');
  var submitBtn = mc.querySelector('#wz-form-submit');
  var errorEl = mc.querySelector('#wz-form-error');

  var name = nameEl ? nameEl.value.trim() : '';
  var email = emailEl ? emailEl.value.trim() : '';
  var phone = phoneEl ? phoneEl.value.trim() : '';
  var notes = notesEl ? notesEl.value.trim() : '';

  if(!name || !email){
    if(errorEl){
      errorEl.textContent = 'Compila nome e email.';
      errorEl.style.display = 'block';
    }
    return;
  }
  if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
    if(errorEl){
      errorEl.textContent = 'Inserisci un indirizzo email valido.';
      errorEl.style.display = 'block';
    }
    return;
  }

  if(submitBtn){
    submitBtn.disabled = true;
    submitBtn.innerHTML = IC.send + ' Invio in corso\u2026';
  }
  if(errorEl) errorEl.style.display = 'none';

  var templateParams = {
    from_name: name,
    from_email: email,
    phone: phone || '(non indicato)',
    notes: notes || '(nessuna nota)',
    wizard_summary: getWizardSummaryText()
  };

  emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams, EMAILJS_PUBLIC_KEY)
    .then(function(){
      renderModal('success');
    })
    .catch(function(err){
      console.error('EmailJS error:', err);
      renderModal('error');
    });
}

function renderModal(state){
  var mc=document.getElementById('modalContent');

  if(state === 'success'){
    mc.innerHTML='<button class="wz-modal-close" onclick="closeModal()">'+IC.close+'</button>'
      +'<div class="wz-success">'
      +IC.checkLg
      +'<h3 style="margin-top:12px">Richiesta inviata!</h3>'
      +'<p>Ti risponderemo entro 2 giorni lavorativi.</p>'
      +'</div>';

  } else if(state === 'error'){
    mc.innerHTML='<button class="wz-modal-close" onclick="closeModal()">'+IC.close+'</button>'
      +'<div class="wz-success">'
      +IC.alert
      +'<h3 style="margin-top:12px">Errore nell\'invio</h3>'
      +'<p>Si è verificato un problema. Riprova tra qualche istante oppure scrivici direttamente a <a href="mailto:postmaster@iptopics.com">postmaster@iptopics.com</a>.</p>'
      +'<button class="btn btn-primary" style="margin-top:16px" onclick="renderModal(\'form\')">'+IC.restart+' Riprova</button>'
      +'</div>';

  } else {
    mc.innerHTML='<button class="wz-modal-close" onclick="closeModal()">'+IC.close+'</button>'
      +'<h3>Richiedi una consulenza</h3>'
      +'<p>Il riepilogo del wizard verrà allegato automaticamente.</p>'
      +'<div id="wz-form-error" class="wz-form-error"></div>'
      +'<div class="wz-field"><label>Nome e cognome *</label><input id="wz-form-name" type="text" placeholder="Mario Rossi"></div>'
      +'<div class="wz-field"><label>Email *</label><input id="wz-form-email" type="email" placeholder="mario@esempio.it"></div>'
      +'<div class="wz-field"><label>Telefono (facoltativo)</label><input id="wz-form-phone" type="tel" placeholder="+39 ..."></div>'
      +'<div class="wz-field"><label>Note (facoltativo)</label><textarea id="wz-form-notes" rows="3" placeholder="Descrivi brevemente la tua situazione..."></textarea></div>'
      +'<button id="wz-form-submit" class="btn btn-primary" style="width:100%" onclick="sendForm()">'+IC.send+' Invia richiesta</button>';
  }
}


/* ===== RENDER ===== */
function renderCore(){
 var el=document.getElementById('wizardContent'),
  ft=document.getElementById('wizardFooter'), fi=document.getElementById('footerInner'),
  hr=document.getElementById('headerRestart'),
  pt=document.getElementById('progressTrack'), pb=document.getElementById('progressBar');

 var vis=getVisible(), tot=vis.length;
 if(!tot) return;
 if(step<0) step=0;
 if(step>=tot) step=tot-1;
 var c=vis[step];
 var pct=c.type==='welcome'?0:c.type==='summary'?100:Math.round((step/(tot-1))*100);

 hr.style.display=step>0?'flex':'none';
 pt.style.display=c.type!=='welcome'?'block':'none';
 pb.style.width=pct+'%';

 el.style.animation='none';
 el.offsetHeight;
 el.style.animation='fadeUp .25s ease';

 if(c.type==='welcome'){
   ft.style.display='none';
   el.innerHTML='<div class="wz-welcome">'
     +'<div class="wz-welcome-icon">'+IC.shield+'</div>'
     +'<h1>Trova la tutela IP giusta per te</h1>'
     +'<p>Un percorso guidato per capire quale strumento di proprietà intellettuale fa al caso tuo: marchio, brevetto, design, diritto d\'autore, segreto industriale o contratti.</p>'
     +'<p class="wz-sub">5\u20137 domande \u00B7 circa 2 minuti \u00B7 con spiegazioni per ogni passaggio</p>'
     +'<button class="btn btn-primary" onclick="goNext()">Inizia il percorso '+IC.arrowR+'</button>'
     +'<p class="wz-disclaimer">Questo strumento ha finalità orientativa e informativa. Non sostituisce una consulenza professionale.</p>'
     +'</div>';
   return;
 }

 if(c.type==='single'||c.type==='multi'){
   var qNum=step, qTot=tot-2;
   var h='<div class="wz-step-label">Domanda '+qNum+' di '+qTot+'</div>'
     +'<h2 class="wz-question">'+c.question+'</h2>'
     +(c.subtitle?'<p class="wz-subtitle">'+c.subtitle+'</p>':'');
   if(c.type==='multi') h+='<div class="wz-multi-hint">\u2713 Puoi selezionare più opzioni</div>';
   h+='<div>';
   for(var oi=0;oi<c.options.length;oi++){
     var o=c.options[oi];
     var sel=c.type==='single'?answers[c.id]===o.value:(answers[c.id]||[]).indexOf(o.value)!==-1;
     var fn=c.type==='single'?"pick('"+c.id+"','"+o.value+"')":"toggle('"+c.id+"','"+o.value+"')";
     h+='<button class="wz-option '+(sel?'selected':'')+'" onclick="'+fn+'">'
       +'<div class="wz-option-inner">'
       +'<div class="wz-radio"><div class="wz-radio-dot"></div></div>'
       +'<div>'
       +'<div class="wz-option-label">'+o.label+'</div>'
       +(o.desc?'<div class="wz-option-desc">'+o.desc+'</div>':'')
       +'</div></div></button>';
   }
   h+='</div>';

   var g=GUIDES[c.id];
   if(g){
     h+='<div class="wz-guide" id="guide_'+c.id+'">'
       +'<button class="wz-guide-toggle" onclick="toggleGuide(\''+c.id+'\')">'
       +IC.book
       +'<span class="wz-guide-title">'+g.title+'</span>'
       +IC.chevron
       +'</button>'
       +'<div class="wz-guide-content"><div class="wz-guide-text">'+g.content+'</div></div>'
       +'</div>';
   }

   el.innerHTML=h;
   ft.style.display='block';
   fi.innerHTML='<button class="btn-ghost" onclick="goBack()">'+IC.arrowL+' Indietro</button>'
     +'<button class="btn btn-primary" onclick="goNext()" '+(canNext()?'':'disabled')+'>Avanti '+IC.arrowR+'</button>';
   return;
 }

 if(c.type==='summary'){
   var rec=getRec(answers);
   var h2='<div class="wz-step-label">Risultato</div>'
     +'<h2 class="wz-question">Riepilogo e orientamento</h2>'
     +'<p class="wz-subtitle">Ecco le tue risposte e il nostro consiglio preliminare.</p>';

   if(rec){
     h2+='<div class="wz-rec">'
       +'<div class="wz-rec-header">'+IC.shieldSm+'<h3>'+rec.title+'</h3></div>'
       +'<p>'+rec.text+'</p>'
       +'<div class="wz-rec-steps">'
       +'<div class="wz-rec-steps-title">Prossimi passi consigliati:</div>';
     for(var ni=0;ni<rec.next.length;ni++){
       h2+='<div class="wz-rec-step"><span class="wz-rec-step-num">'+(ni+1)+'.</span><span class="wz-rec-step-text">'+rec.next[ni]+'</span></div>';
     }
     h2+='</div></div>';
   }

   h2+='<div class="wz-answers"><div class="wz-answers-title">Le tue risposte</div>';
   var allLines=getLines();
   for(var li=0;li<allLines.length;li++){
     h2+='<div class="wz-answer-row"><div class="wz-answer-q">'+allLines[li].q+'</div><div class="wz-answer-a">'+allLines[li].a+'</div></div>';
   }
   h2+='</div>';

   h2+=getLearn(answers);

   h2+='<div class="wz-actions">'
     +'<button class="btn btn-secondary" style="flex:1 1 0" id="copyBtn" onclick="doCopy()">'+IC.copy+' Copia riepilogo</button>'
     +'<button class="btn btn-primary" style="flex:1 1 0" onclick="showModal()">'+IC.send+' Richiedi consulenza</button>'
     +'</div>'
     +'<p class="wz-disclaimer-sm">Questo orientamento ha finalità informativa. Per una valutazione specifica, richiedi una consulenza.</p>';

   el.innerHTML=h2;
   ft.style.display='block';
   fi.innerHTML='<button class="btn-ghost" onclick="goBack()">'+IC.arrowL+' Modifica risposte</button>'
     +'<button class="btn-ghost-red" onclick="restart()">'+IC.restart+' Nuovo percorso</button>';
 }
}


function render(){
 try{
   renderCore();
 }catch(e){
   console.error(e);
   var el=document.getElementById('wizardContent');
   var ft=document.getElementById('wizardFooter');
   var pt=document.getElementById('progressTrack');
   if(ft) ft.style.display='none';
   if(pt) pt.style.display='none';
   if(el){
     el.innerHTML = '<div class="wz-welcome">'
       +'<div class="wz-welcome-icon">'+IC.shield+'</div>'
       +'<h1>Ops, qualcosa è andato storto</h1>'
       +'<p>Si è verificato un errore tecnico nel percorso. Puoi ripartire da capo.</p>'
       +'<p class="wz-sub" style="text-align:left;background:var(--g50);border:1px solid var(--g200);padding:12px;border-radius:10px;overflow:auto;max-height:160px">'
       +'<b>Errore:</b> '+String(e && (e.stack||e.message||e)).replace(/</g,'&lt;')
       +'</p>'
       +'<button class="btn btn-primary" onclick="restart()">'+IC.restart+' Ricomincia</button>'
       +'</div>';
   }
 }
}

function toggleGuide(id){
 var el=document.getElementById('guide_'+id);
 if(el) el.classList.toggle('open');
}

/* ===== INIT ===== */
render();
</script>


</body></html>